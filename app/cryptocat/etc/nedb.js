module.exports={};
(function(r){function v(f){if(l[f])return l[f].exports;var k=l[f]={exports:{},id:f,loaded:!1};r[f].call(k.exports,k,k.exports,v);k.loaded=!0;0===f&&(module.exports=k.exports);return k.exports}var l={};v.m=r;v.c=l;v.p="";return v(0)})([function(r,v,l){function f(a){var d;"string"===typeof a?(d=a,this.inMemoryOnly=!1):(a=a||{},d=a.filename,this.inMemoryOnly=a.inMemoryOnly||!1,this.autoload=a.autoload||!1,this.timestampData=a.timestampData||!1);d&&"string"===typeof d&&0!==d.length?this.filename=d:(this.filename=
null,this.inMemoryOnly=!0);this.compareStrings=a.compareStrings;this.persistence=new e({db:this,nodeWebkitAppName:a.nodeWebkitAppName,afterSerialization:a.afterSerialization,beforeDeserialization:a.beforeDeserialization,corruptAlertThreshold:a.corruptAlertThreshold});this.executor=new b;this.inMemoryOnly&&(this.executor.ready=!0);this.indexes={};this.indexes._id=new t({fieldName:"_id",unique:!0});this.ttlIndexes={};this.autoload&&this.loadDatabase(a.onload||function(a){if(a)throw a;})}var k=l(1),
q=l(3),a=l(6),b=l(7),t=l(8),g=l(4),d=l(5),e=l(13),h=l(18);g.inherits(f,l(19).EventEmitter);f.prototype.loadDatabase=function(){this.executor.push({"this":this.persistence,fn:this.persistence.loadDatabase,arguments:arguments},!0)};f.prototype.getAllData=function(){return this.indexes._id.getAll()};f.prototype.resetIndexes=function(a){var d=this;Object.keys(this.indexes).forEach(function(b){d.indexes[b].reset(a)})};f.prototype.ensureIndex=function(a,d){var b,e=d||function(){};a=a||{};if(!a.fieldName)return b=
Error("Cannot create an index without a fieldName"),b.missingFieldName=!0,e(b);if(this.indexes[a.fieldName])return e(null);this.indexes[a.fieldName]=new t(a);void 0!==a.expireAfterSeconds&&(this.ttlIndexes[a.fieldName]=a.expireAfterSeconds);try{this.indexes[a.fieldName].insert(this.getAllData())}catch(g){return delete this.indexes[a.fieldName],e(g)}this.persistence.persistNewState([{$$indexCreated:a}],function(a){return a?e(a):e(null)})};f.prototype.removeIndex=function(a,d){var b=d||function(){};
delete this.indexes[a];this.persistence.persistNewState([{$$indexRemoved:a}],function(a){return a?b(a):b(null)})};f.prototype.addToIndexes=function(a){var d,b,e,g=Object.keys(this.indexes);for(d=0;d<g.length;d+=1)try{this.indexes[g[d]].insert(a)}catch(h){b=d;e=h;break}if(e){for(d=0;d<b;d+=1)this.indexes[g[d]].remove(a);throw e;}};f.prototype.removeFromIndexes=function(a){var d=this;Object.keys(this.indexes).forEach(function(b){d.indexes[b].remove(a)})};f.prototype.updateIndexes=function(a,d){var b,
e,g,h=Object.keys(this.indexes);for(b=0;b<h.length;b+=1)try{this.indexes[h[b]].update(a,d)}catch(t){e=b;g=t;break}if(g){for(b=0;b<e;b+=1)this.indexes[h[b]].revertUpdate(a,d);throw g;}};f.prototype.getCandidates=function(b,e,h){var t=Object.keys(this.indexes),f=this,k;"function"===typeof e&&(h=e,e=!1);a.waterfall([function(a){k=[];Object.keys(b).forEach(function(a){("string"===typeof b[a]||"number"===typeof b[a]||"boolean"===typeof b[a]||g.isDate(b[a])||null===b[a])&&k.push(a)});k=d.intersection(k,
t);if(0<k.length)return a(null,f.indexes[k[0]].getMatching(b[k[0]]));k=[];Object.keys(b).forEach(function(a){b[a]&&b[a].hasOwnProperty("$in")&&k.push(a)});k=d.intersection(k,t);if(0<k.length)return a(null,f.indexes[k[0]].getMatching(b[k[0]].$in));k=[];Object.keys(b).forEach(function(a){b[a]&&(b[a].hasOwnProperty("$lt")||b[a].hasOwnProperty("$lte")||b[a].hasOwnProperty("$gt")||b[a].hasOwnProperty("$gte"))&&k.push(a)});k=d.intersection(k,t);return 0<k.length?a(null,f.indexes[k[0]].getBetweenBounds(b[k[0]])):
a(null,f.getAllData())},function(b){if(e)return h(null,b);var d=[],n=[],x=Object.keys(f.ttlIndexes);b.forEach(function(a){var c=!0;x.forEach(function(u){void 0!==a[u]&&g.isDate(a[u])&&Date.now()>a[u].getTime()+1E3*f.ttlIndexes[u]&&(c=!1)});c?n.push(a):d.push(a._id)});a.eachSeries(d,function(a,c){f._remove({_id:a},{},function(a){return a?h(a):c()})},function(a){return h(null,n)})}])};f.prototype._insert=function(a,b){var d=b||function(){},e;try{e=this.prepareDocumentForInsertion(a),this._insertInCache(e)}catch(h){return d(h)}this.persistence.persistNewState(g.isArray(e)?
e:[e],function(a){return a?d(a):d(null,q.deepCopy(e))})};f.prototype.createNewId=function(){var a=k.uid(16);0<this.indexes._id.getMatching(a).length&&(a=this.createNewId());return a};f.prototype.prepareDocumentForInsertion=function(a){var b,d=this;g.isArray(a)?(b=[],a.forEach(function(a){b.push(d.prepareDocumentForInsertion(a))})):(b=q.deepCopy(a),void 0===b._id&&(b._id=this.createNewId()),a=new Date,this.timestampData&&void 0===b.createdAt&&(b.createdAt=a),this.timestampData&&void 0===b.updatedAt&&
(b.updatedAt=a),q.checkObject(b));return b};f.prototype._insertInCache=function(a){g.isArray(a)?this._insertMultipleDocsInCache(a):this.addToIndexes(a)};f.prototype._insertMultipleDocsInCache=function(a){var b,d,e;for(b=0;b<a.length;b+=1)try{this.addToIndexes(a[b])}catch(g){e=g;d=b;break}if(e){for(b=0;b<d;b+=1)this.removeFromIndexes(a[b]);throw e;}};f.prototype.insert=function(){this.executor.push({"this":this,fn:this._insert,arguments:arguments})};f.prototype.count=function(a,b){var d=new h(this,
a,function(a,b,d){return a?d(a):d(null,b.length)});if("function"===typeof b)d.exec(b);else return d};f.prototype.find=function(a,b,d){switch(arguments.length){case 1:b={};break;case 2:"function"===typeof b&&(d=b,b={})}var e=new h(this,a,function(a,b,d){var e=[];if(a)return d(a);for(a=0;a<b.length;a+=1)e.push(q.deepCopy(b[a]));return d(null,e)});e.projection(b);if("function"===typeof d)e.exec(d);else return e};f.prototype.findOne=function(a,b,d){switch(arguments.length){case 1:b={};break;case 2:"function"===
typeof b&&(d=b,b={})}var e=new h(this,a,function(a,b,d){return a?d(a):1===b.length?d(null,q.deepCopy(b[0])):d(null,null)});e.projection(b).limit(1);if("function"===typeof d)e.exec(d);else return e};f.prototype._update=function(b,e,g,t){var f,k=this,l=0,m,n,x;"function"===typeof g&&(t=g,g={});f=t||function(){};m=void 0!==g.multi?g.multi:!1;n=void 0!==g.upsert?g.upsert:!1;a.waterfall([function(a){if(!n)return a();(new h(k,b)).limit(1)._exec(function(c,u){if(c)return f(c);if(1===u.length)return a();
var d;try{q.checkObject(e),d=e}catch(g){try{d=q.modify(q.deepCopy(b,!0),e)}catch(m){return f(m)}}return k._insert(d,function(c,a){return c?f(c):f(null,1,a,!0)})})},function(){var a,c=[],u;k.getCandidates(b,function(n,h){if(n)return f(n);try{for(x=0;x<h.length;x+=1)q.match(h[x],b)&&(m||0===l)&&(l+=1,k.timestampData&&(u=h[x].createdAt),a=q.modify(h[x],e),k.timestampData&&(a.createdAt=u,a.updatedAt=new Date),c.push({oldDoc:h[x],newDoc:a}))}catch(t){return f(t)}try{k.updateIndexes(c)}catch(t){return f(t)}var p=
d.pluck(c,"newDoc");k.persistence.persistNewState(p,function(c){if(c)return f(c);if(g.returnUpdatedDocs){var a=[];p.forEach(function(c){a.push(q.deepCopy(c))});m||(a=a[0]);return f(null,l,a)}return f(null,l)})})}])};f.prototype.update=function(){this.executor.push({"this":this,fn:this._update,arguments:arguments})};f.prototype._remove=function(a,b,d){var e,g=this,h=0,f=[],m;"function"===typeof b&&(d=b,b={});e=d||function(){};m=void 0!==b.multi?b.multi:!1;this.getCandidates(a,!0,function(b,d){if(b)return e(b);
try{d.forEach(function(D){q.match(D,a)&&(m||0===h)&&(h+=1,f.push({$$deleted:!0,_id:D._id}),g.removeFromIndexes(D))})}catch(D){return e(D)}g.persistence.persistNewState(f,function(a){return a?e(a):e(null,h)})})};f.prototype.remove=function(){this.executor.push({"this":this,fn:this._remove,arguments:arguments})};r.exports=f},function(r,v,l){var f=l(2);r.exports.uid=function(k){return f.randomBytes(Math.ceil(Math.max(8,2*k))).toString("base64").replace(/[+\/]/g,"").slice(0,k)}},function(r,v){r.exports=
require("crypto")},function(r,v,l){function f(a,c){"number"===typeof a&&(a=a.toString());if(!("$"!==a[0]||"$$date"===a&&"number"===typeof c||"$$deleted"===a&&!0===c)&&"$$indexCreated"!==a&&"$$indexRemoved"!==a)throw Error("Field names cannot begin with the $ character");if(-1!==a.indexOf("."))throw Error("Field names cannot contain a .");}function k(a){p.isArray(a)&&a.forEach(function(c){k(c)});"object"===typeof a&&null!==a&&Object.keys(a).forEach(function(c){f(c,a[c]);k(a[c])})}function q(a,c){var b;
if("boolean"===typeof a||"number"===typeof a||"string"===typeof a||null===a||p.isDate(a))return a;if(p.isArray(a))return b=[],a.forEach(function(a){b.push(q(a,c))}),b;if("object"===typeof a)return b={},Object.keys(a).forEach(function(d){if(!c||"$"!==d[0]&&-1===d.indexOf("."))b[d]=q(a[d],c)}),b}function a(a){return"boolean"===typeof a||"number"===typeof a||"string"===typeof a||null===a||p.isDate(a)||p.isArray(a)}function b(a,c){return a<c?-1:a>c?1:0}function t(a,c){var u,d;for(u=0;u<Math.min(a.length,
c.length);u+=1)if(d=g(a[u],c[u]),0!==d)return d;return b(a.length,c.length)}function g(a,c,u){var d,e,m;u=u||b;if(void 0===a)return void 0===c?0:-1;if(void 0===c)return void 0===a?0:1;if(null===a)return null===c?0:-1;if(null===c)return null===a?0:1;if("number"===typeof a)return"number"===typeof c?b(a,c):-1;if("number"===typeof c)return"number"===typeof a?b(a,c):1;if("string"===typeof a)return"string"===typeof c?u(a,c):-1;if("string"===typeof c)return"string"===typeof a?u(a,c):1;if("boolean"===typeof a)return"boolean"===
typeof c?b(a,c):-1;if("boolean"===typeof c)return"boolean"===typeof a?b(a,c):1;if(p.isDate(a))return p.isDate(c)?b(a.getTime(),c.getTime()):-1;if(p.isDate(c))return p.isDate(a)?b(a.getTime(),c.getTime()):1;if(p.isArray(a))return p.isArray(c)?t(a,c):-1;if(p.isArray(c))return p.isArray(a)?t(a,c):1;u=Object.keys(a).sort();d=Object.keys(c).sort();for(m=0;m<Math.min(u.length,d.length);m+=1)if(e=g(a[u[m]],c[d[m]]),0!==e)return e;return b(u.length,d.length)}function d(a){return function(c,b,d){var e="string"===
typeof b?b.split("."):b;if(1===e.length)z[a](c,b,d);else{if(void 0===c[e[0]]){if("$unset"===a)return;c[e[0]]={}}w[a](c[e[0]],e.slice(1),d)}}}function e(a,c){var b="string"===typeof c?c.split("."):c,d,g;if(a){if(0===b.length)return a;if(1===b.length)return a[b[0]];if(p.isArray(a[b[0]])){d=parseInt(b[1],10);if("number"===typeof d&&!isNaN(d))return e(a[b[0]][d],b.slice(2));g=[];for(d=0;d<a[b[0]].length;d+=1)g.push(e(a[b[0]][d],b.slice(1)));return g}return e(a[b[0]],b.slice(1))}}function h(a,c){var b,
d,e;if(null===a||"string"===typeof a||"boolean"===typeof a||"number"===typeof a||null===c||"string"===typeof c||"boolean"===typeof c||"number"===typeof c)return a===c;if(p.isDate(a)||p.isDate(c))return p.isDate(a)&&p.isDate(c)&&a.getTime()===c.getTime();if(!(p.isArray(a)&&p.isArray(c)||!p.isArray(a)&&!p.isArray(c))||void 0===a||void 0===c)return!1;try{b=Object.keys(a),d=Object.keys(c)}catch(g){return!1}if(b.length!==d.length)return!1;for(e=0;e<b.length;e+=1)if(-1===d.indexOf(b[e])||!h(a[b[e]],c[b[e]]))return!1;
return!0}function A(a,c){return"string"!==typeof a&&"number"!==typeof a&&!p.isDate(a)&&"string"!==typeof c&&"number"!==typeof c&&!p.isDate(c)||typeof a!==typeof c?!1:!0}function y(b,c){var d,e,g,m;if(a(b)||a(c))return E({needAKey:b},"needAKey",c);d=Object.keys(c);for(m=0;m<d.length;m+=1)if(e=d[m],g=c[e],"$"===e[0]){if(!n[e])throw Error("Unknown logical operator "+e);if(!n[e](b,g))return!1}else if(!E(b,e,g))return!1;return!0}function E(a,c,b,d){var g=e(a,c),n;if(p.isArray(g)&&!d){if(p.isArray(b))return E(a,
c,b,!0);if(null!==b&&"object"===typeof b&&!p.isRegExp(b))for(d=Object.keys(b),n=0;n<d.length;n+=1)if(x[d[n]])return E(a,c,b,!0);for(n=0;n<g.length;n+=1)if(E({k:g[n]},"k",b))return!0;return!1}if(null!==b&&"object"===typeof b&&!p.isRegExp(b)&&!p.isArray(b)){d=Object.keys(b);a=C.map(d,function(a){return a[0]});c=C.filter(a,function(a){return"$"===a});if(0!==c.length&&c.length!==a.length)throw Error("You cannot mix operators and normal fields");if(0<c.length){for(n=0;n<d.length;n+=1){if(!m[d[n]])throw Error("Unknown comparison function "+
d[n]);if(!m[d[n]](g,b[d[n]]))return!1}return!0}}return p.isRegExp(b)?m.$regex(g,b):h(g,b)?!0:!1}var p=l(4),C=l(5),w={},z={},m={},n={},x={};z.$set=function(a,c,b){a[c]=b};z.$unset=function(a,c,b){delete a[c]};z.$push=function(a,c,b){a.hasOwnProperty(c)||(a[c]=[]);if(!p.isArray(a[c]))throw Error("Can't $push an element on non-array values");null!==b&&"object"===typeof b&&b.$slice&&void 0===b.$each&&(b.$each=[]);if(null!==b&&"object"===typeof b&&b.$each){if(3<=Object.keys(b).length||2===Object.keys(b).length&&
void 0===b.$slice)throw Error("Can only use $slice in cunjunction with $each when $push to array");if(!p.isArray(b.$each))throw Error("$each requires an array value");b.$each.forEach(function(b){a[c].push(b)});if(void 0!==b.$slice&&"number"===typeof b.$slice)if(0===b.$slice)a[c]=[];else{var d,e,g=a[c].length;0>b.$slice?(d=Math.max(0,g+b.$slice),e=g):0<b.$slice&&(d=0,e=Math.min(g,b.$slice));a[c]=a[c].slice(d,e)}}else a[c].push(b)};z.$addToSet=function(a,c,b){var d=!0;a.hasOwnProperty(c)||(a[c]=[]);
if(!p.isArray(a[c]))throw Error("Can't $addToSet an element on non-array values");if(null!==b&&"object"===typeof b&&b.$each){if(1<Object.keys(b).length)throw Error("Can't use another field in conjunction with $each");if(!p.isArray(b.$each))throw Error("$each requires an array value");b.$each.forEach(function(b){z.$addToSet(a,c,b)})}else a[c].forEach(function(a){0===g(a,b)&&(d=!1)}),d&&a[c].push(b)};z.$pop=function(a,c,b){if(!p.isArray(a[c]))throw Error("Can't $pop an element from non-array values");
if("number"!==typeof b)throw Error(b+" isn't an integer, can't use it with $pop");0!==b&&(a[c]=0<b?a[c].slice(0,a[c].length-1):a[c].slice(1))};z.$pull=function(a,c,b){if(!p.isArray(a[c]))throw Error("Can't $pull an element from non-array values");a=a[c];for(c=a.length-1;0<=c;--c)y(a[c],b)&&a.splice(c,1)};z.$inc=function(a,c,b){if("number"!==typeof b)throw Error(b+" must be a number");if("number"!==typeof a[c]){if(C.has(a,c))throw Error("Don't use the $inc modifier on non-number fields");a[c]=b}else a[c]+=
b};z.$max=function(a,c,b){"undefined"===typeof a[c]?a[c]=b:b>a[c]&&(a[c]=b)};z.$min=function(a,c,b){"undefined"===typeof a[c]?a[c]=b:b<a[c]&&(a[c]=b)};Object.keys(z).forEach(function(a){w[a]=d(a)});m.$lt=function(a,c){return A(a,c)&&a<c};m.$lte=function(a,c){return A(a,c)&&a<=c};m.$gt=function(a,c){return A(a,c)&&a>c};m.$gte=function(a,c){return A(a,c)&&a>=c};m.$ne=function(a,c){return void 0===a?!0:!h(a,c)};m.$in=function(a,c){var b;if(!p.isArray(c))throw Error("$in operator called with a non-array");
for(b=0;b<c.length;b+=1)if(h(a,c[b]))return!0;return!1};m.$nin=function(a,c){if(!p.isArray(c))throw Error("$nin operator called with a non-array");return!m.$in(a,c)};m.$regex=function(a,c){if(!p.isRegExp(c))throw Error("$regex operator called with non regular expression");return"string"!==typeof a?!1:c.test(a)};m.$exists=function(a,c){c=c||""===c?!0:!1;return void 0===a?!c:c};m.$size=function(a,c){if(!p.isArray(a))return!1;if(0!==c%1)throw Error("$size operator called without an integer");return a.length==
c};m.$elemMatch=function(a,c){if(!p.isArray(a))return!1;for(var b=a.length,d=!1;b--;)if(y(a[b],c)){d=!0;break}return d};x.$size=!0;x.$elemMatch=!0;n.$or=function(a,c){var b;if(!p.isArray(c))throw Error("$or operator used without an array");for(b=0;b<c.length;b+=1)if(y(a,c[b]))return!0;return!1};n.$and=function(a,c){var b;if(!p.isArray(c))throw Error("$and operator used without an array");for(b=0;b<c.length;b+=1)if(!y(a,c[b]))return!1;return!0};n.$not=function(a,c){return!y(a,c)};n.$where=function(a,
c){var b;if(!C.isFunction(c))throw Error("$where operator used without a function");b=c.call(a);if(!C.isBoolean(b))throw Error("$where function must return boolean");return b};r.exports.serialize=function(a){return JSON.stringify(a,function(a,b){f(a,b);return void 0===b?void 0:null===b?null:"function"===typeof this[a].getTime?{$$date:this[a].getTime()}:b})};r.exports.deserialize=function(a){return JSON.parse(a,function(a,b){return"$$date"===a?new Date(b):"string"===typeof b||"number"===typeof b||
"boolean"===typeof b||null===b?b:b&&b.$$date?b.$$date:b})};r.exports.deepCopy=q;r.exports.checkObject=k;r.exports.isPrimitiveType=a;r.exports.modify=function(a,c){var b=Object.keys(c),d=C.map(b,function(a){return a[0]}),e=C.filter(d,function(a){return"$"===a}),g;if(-1!==b.indexOf("_id")&&c._id!==a._id)throw Error("You cannot change a document's _id");if(0!==e.length&&e.length!==d.length)throw Error("You cannot mix modifiers and normal fields");0===e.length?(g=q(c),g._id=a._id):(b=C.uniq(b),g=q(a),
b.forEach(function(a){if(!w[a])throw Error("Unknown modifier "+a);if("object"!==typeof c[a])throw Error("Modifier "+a+"'s argument must be an object");Object.keys(c[a]).forEach(function(b){w[a](g,b,c[a][b])})}));k(g);if(a._id!==g._id)throw Error("You can't change a document's _id");return g};r.exports.getDotValue=e;r.exports.match=y;r.exports.areThingsEqual=h;r.exports.compareThings=g},function(r,v){r.exports=require("util")},function(r,v,l){(function(){var f=this,k=f._,q={},a=Array.prototype,b=Object.prototype,
t=a.push,g=a.slice,d=a.concat,e=b.toString,h=b.hasOwnProperty,A=a.forEach,y=a.map,l=a.reduce,p=a.reduceRight,C=a.filter,w=a.every,z=a.some,m=a.indexOf,n=a.lastIndexOf,b=Array.isArray,x=Object.keys,D=Function.prototype.bind,c=function(a){if(a instanceof c)return a;if(!(this instanceof c))return new c(a);this._wrapped=a};"undefined"!==typeof r&&r.exports&&(v=r.exports=c);v._=c;c.VERSION="1.4.4";var u=c.each=c.forEach=function(a,b,d){if(null!=a)if(A&&a.forEach===A)a.forEach(b,d);else if(a.length===+a.length)for(var e=
0,g=a.length;e<g&&b.call(d,a[e],e,a)!==q;e++);else for(e in a)if(c.has(a,e)&&b.call(d,a[e],e,a)===q)break};c.map=c.collect=function(a,c,b){var d=[];if(null==a)return d;if(y&&a.map===y)return a.map(c,b);u(a,function(a,B,e){d[d.length]=c.call(b,a,B,e)});return d};c.reduce=c.foldl=c.inject=function(a,b,d,e){var g=2<arguments.length;null==a&&(a=[]);if(l&&a.reduce===l)return e&&(b=c.bind(b,e)),g?a.reduce(b,d):a.reduce(b);u(a,function(a,c,B){g?d=b.call(e,d,a,c,B):(d=a,g=!0)});if(!g)throw new TypeError("Reduce of empty array with no initial value");
return d};c.reduceRight=c.foldr=function(a,b,d,e){var g=2<arguments.length;null==a&&(a=[]);if(p&&a.reduceRight===p)return e&&(b=c.bind(b,e)),g?a.reduceRight(b,d):a.reduceRight(b);var m=a.length;if(m!==+m)var n=c.keys(a),m=n.length;u(a,function(c,h,f){h=n?n[--m]:--m;g?d=b.call(e,d,a[h],h,f):(d=a[h],g=!0)});if(!g)throw new TypeError("Reduce of empty array with no initial value");return d};c.find=c.detect=function(a,c,b){var d;G(a,function(a,B,e){if(c.call(b,a,B,e))return d=a,!0});return d};c.filter=
c.select=function(a,c,b){var d=[];if(null==a)return d;if(C&&a.filter===C)return a.filter(c,b);u(a,function(a,B,e){c.call(b,a,B,e)&&(d[d.length]=a)});return d};c.reject=function(a,b,d){return c.filter(a,function(a,c,B){return!b.call(d,a,c,B)},d)};c.every=c.all=function(a,b,d){b||(b=c.identity);var e=!0;if(null==a)return e;if(w&&a.every===w)return a.every(b,d);u(a,function(a,c,B){if(!(e=e&&b.call(d,a,c,B)))return q});return!!e};var G=c.some=c.any=function(a,b,d){b||(b=c.identity);var e=!1;if(null==
a)return e;if(z&&a.some===z)return a.some(b,d);u(a,function(a,c,B){if(e||(e=b.call(d,a,c,B)))return q});return!!e};c.contains=c.include=function(a,c){return null==a?!1:m&&a.indexOf===m?-1!=a.indexOf(c):G(a,function(a){return a===c})};c.invoke=function(a,b){var d=g.call(arguments,2),e=c.isFunction(b);return c.map(a,function(a){return(e?b:a[b]).apply(a,d)})};c.pluck=function(a,b){return c.map(a,function(a){return a[b]})};c.where=function(a,b,d){return c.isEmpty(b)?d?null:[]:c[d?"find":"filter"](a,function(a){for(var c in b)if(b[c]!==
a[c])return!1;return!0})};c.findWhere=function(a,b){return c.where(a,b,!0)};c.max=function(a,b,d){if(!b&&c.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!b&&c.isEmpty(a))return-Infinity;var e={computed:-Infinity,value:-Infinity};u(a,function(a,c,B){c=b?b.call(d,a,c,B):a;c>=e.computed&&(e={value:a,computed:c})});return e.value};c.min=function(a,b,d){if(!b&&c.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!b&&c.isEmpty(a))return Infinity;var e=
{computed:Infinity,value:Infinity};u(a,function(a,c,B){c=b?b.call(d,a,c,B):a;c<e.computed&&(e={value:a,computed:c})});return e.value};c.shuffle=function(a){var b,d=0,e=[];u(a,function(a){b=c.random(d++);e[d-1]=e[b];e[b]=a});return e};var I=function(a){return c.isFunction(a)?a:function(c){return c[a]}};c.sortBy=function(a,b,d){var e=I(b);return c.pluck(c.map(a,function(a,c,b){return{value:a,index:c,criteria:e.call(d,a,c,b)}}).sort(function(a,c){var b=a.criteria,d=c.criteria;if(b!==d){if(b>d||void 0===
b)return 1;if(b<d||void 0===d)return-1}return a.index<c.index?-1:1}),"value")};var H=function(a,b,d,e){var g={},m=I(b||c.identity);u(a,function(c,b){var n=m.call(d,c,b,a);e(g,n,c)});return g};c.groupBy=function(a,b,d){return H(a,b,d,function(a,b,d){(c.has(a,b)?a[b]:a[b]=[]).push(d)})};c.countBy=function(a,b,d){return H(a,b,d,function(a,b){c.has(a,b)||(a[b]=0);a[b]++})};c.sortedIndex=function(a,b,d,e){d=null==d?c.identity:I(d);b=d.call(e,b);for(var g=0,m=a.length;g<m;){var n=g+m>>>1;d.call(e,a[n])<
b?g=n+1:m=n}return g};c.toArray=function(a){return a?c.isArray(a)?g.call(a):a.length===+a.length?c.map(a,c.identity):c.values(a):[]};c.size=function(a){return null==a?0:a.length===+a.length?a.length:c.keys(a).length};c.first=c.head=c.take=function(a,c,b){return null==a?void 0:null==c||b?a[0]:g.call(a,0,c)};c.initial=function(a,c,b){return g.call(a,0,a.length-(null==c||b?1:c))};c.last=function(a,c,b){return null==a?void 0:null==c||b?a[a.length-1]:g.call(a,Math.max(a.length-c,0))};c.rest=c.tail=c.drop=
function(a,c,b){return g.call(a,null==c||b?1:c)};c.compact=function(a){return c.filter(a,c.identity)};var M=function(a,b,d){u(a,function(a){c.isArray(a)?b?t.apply(d,a):M(a,b,d):d.push(a)});return d};c.flatten=function(a,c){return M(a,c,[])};c.without=function(a){return c.difference(a,g.call(arguments,1))};c.uniq=c.unique=function(a,b,d,e){c.isFunction(b)&&(e=d,d=b,b=!1);d=d?c.map(a,d,e):a;var g=[],m=[];u(d,function(d,e){(b?e&&m[m.length-1]===d:c.contains(m,d))||(m.push(d),g.push(a[e]))});return g};
c.union=function(){return c.uniq(d.apply(a,arguments))};c.intersection=function(a){var b=g.call(arguments,1);return c.filter(c.uniq(a),function(a){return c.every(b,function(b){return 0<=c.indexOf(b,a)})})};c.difference=function(b){var e=d.apply(a,g.call(arguments,1));return c.filter(b,function(a){return!c.contains(e,a)})};c.zip=function(){for(var a=g.call(arguments),b=c.max(c.pluck(a,"length")),d=Array(b),e=0;e<b;e++)d[e]=c.pluck(a,""+e);return d};c.object=function(a,c){if(null==a)return{};for(var b=
{},d=0,e=a.length;d<e;d++)c?b[a[d]]=c[d]:b[a[d][0]]=a[d][1];return b};c.indexOf=function(a,b,d){if(null==a)return-1;var e=0,g=a.length;if(d)if("number"==typeof d)e=0>d?Math.max(0,g+d):d;else return e=c.sortedIndex(a,b),a[e]===b?e:-1;if(m&&a.indexOf===m)return a.indexOf(b,d);for(;e<g;e++)if(a[e]===b)return e;return-1};c.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(n&&a.lastIndexOf===n)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(c=d?c:a.length;c--;)if(a[c]===b)return c;return-1};
c.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,g=Array(d);e<d;)g[e++]=a,a+=c;return g};c.bind=function(a,c){if(a.bind===D&&D)return D.apply(a,g.call(arguments,1));var b=g.call(arguments,2);return function(){return a.apply(c,b.concat(g.call(arguments)))}};c.partial=function(a){var c=g.call(arguments,1);return function(){return a.apply(this,c.concat(g.call(arguments)))}};c.bindAll=function(a){var b=g.call(arguments,1);0===b.length&&
(b=c.functions(a));u(b,function(b){a[b]=c.bind(a[b],a)});return a};c.memoize=function(a,b){var d={};b||(b=c.identity);return function(){var e=b.apply(this,arguments);return c.has(d,e)?d[e]:d[e]=a.apply(this,arguments)}};c.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)};c.defer=function(a){return c.delay.apply(c,[a,1].concat(g.call(arguments,1)))};c.throttle=function(a,b){var c,d,e,g,m=0,n=function(){m=new Date;e=null;g=a.apply(c,d)};return function(){var h=
new Date,f=b-(h-m);c=this;d=arguments;0>=f?(clearTimeout(e),e=null,m=h,g=a.apply(c,d)):e||(e=setTimeout(n,f));return g}};c.debounce=function(a,b,c){var d,e;return function(){var g=this,m=arguments,n=c&&!d;clearTimeout(d);d=setTimeout(function(){d=null;c||(e=a.apply(g,m))},b);n&&(e=a.apply(g,m));return e}};c.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;c=a.apply(this,arguments);a=null;return c}};c.wrap=function(a,b){return function(){var c=[a];t.apply(c,arguments);return b.apply(this,
c)}};c.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};c.after=function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}};c.keys=x||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],d;for(d in a)c.has(a,d)&&(b[b.length]=d);return b};c.values=function(a){var b=[],d;for(d in a)c.has(a,d)&&b.push(a[d]);return b};c.pairs=function(a){var b=[],d;for(d in a)c.has(a,d)&&b.push([d,
a[d]]);return b};c.invert=function(a){var b={},d;for(d in a)c.has(a,d)&&(b[a[d]]=d);return b};c.functions=c.methods=function(a){var b=[],d;for(d in a)c.isFunction(a[d])&&b.push(d);return b.sort()};c.extend=function(a){u(g.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]});return a};c.pick=function(b){var c={},e=d.apply(a,g.call(arguments,1));u(e,function(a){a in b&&(c[a]=b[a])});return c};c.omit=function(b){var e={},m=d.apply(a,g.call(arguments,1)),n;for(n in b)c.contains(m,n)||(e[n]=b[n]);
return e};c.defaults=function(a){u(g.call(arguments,1),function(b){if(b)for(var c in b)null==a[c]&&(a[c]=b[c])});return a};c.clone=function(a){return c.isObject(a)?c.isArray(a)?a.slice():c.extend({},a):a};c.tap=function(a,b){b(a);return a};var J=function(a,b,d,g){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof c&&(a=a._wrapped);b instanceof c&&(b=b._wrapped);var m=e.call(a);if(m!=e.call(b))return!1;switch(m){case "[object String]":return a==String(b);case "[object Number]":return a!=
+a?b!=+b:0==a?1/a==1/b:a==+b;case "[object Date]":case "[object Boolean]":return+a==+b;case "[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var n=d.length;n--;)if(d[n]==a)return g[n]==b;d.push(a);g.push(b);var n=0,h=!0;if("[object Array]"==m){if(n=a.length,h=n==b.length)for(;n--&&(h=J(a[n],b[n],d,g)););}else{var m=a.constructor,f=b.constructor;if(m!==f&&!(c.isFunction(m)&&m instanceof
m&&c.isFunction(f)&&f instanceof f))return!1;for(var x in a)if(c.has(a,x)&&(n++,!(h=c.has(b,x)&&J(a[x],b[x],d,g))))break;if(h){for(x in b)if(c.has(b,x)&&!n--)break;h=!n}}d.pop();g.pop();return h};c.isEqual=function(a,b){return J(a,b,[],[])};c.isEmpty=function(a){if(null==a)return!0;if(c.isArray(a)||c.isString(a))return 0===a.length;for(var b in a)if(c.has(a,b))return!1;return!0};c.isElement=function(a){return!(!a||1!==a.nodeType)};c.isArray=b||function(a){return"[object Array]"==e.call(a)};c.isObject=
function(a){return a===Object(a)};u("Arguments Function String Number Date RegExp".split(" "),function(a){c["is"+a]=function(b){return e.call(b)=="[object "+a+"]"}});c.isArguments(arguments)||(c.isArguments=function(a){return!(!a||!c.has(a,"callee"))});c.isFunction=function(a){return"function"===typeof a};c.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};c.isNaN=function(a){return c.isNumber(a)&&a!=+a};c.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==e.call(a)};c.isNull=
function(a){return null===a};c.isUndefined=function(a){return void 0===a};c.has=function(a,b){return h.call(a,b)};c.noConflict=function(){f._=k;return this};c.identity=function(a){return a};c.times=function(a,b,c){for(var d=Array(a),e=0;e<a;e++)d[e]=b.call(c,e);return d};c.random=function(a,b){null==b&&(b=a,a=0);return a+Math.floor(Math.random()*(b-a+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};F.unescape=c.invert(F.escape);var N={escape:new RegExp("["+
c.keys(F.escape).join("")+"]","g"),unescape:new RegExp("("+c.keys(F.unescape).join("|")+")","g")};c.each(["escape","unescape"],function(a){c[a]=function(b){return null==b?"":(""+b).replace(N[a],function(b){return F[a][b]})}});c.result=function(a,b){if(null==a)return null;var d=a[b];return c.isFunction(d)?d.call(a):d};c.mixin=function(a){u(c.functions(a),function(b){var d=c[b]=a[b];c.prototype[b]=function(){var a=[this._wrapped];t.apply(a,arguments);return K.call(this,d.apply(c,a))}})};var O=0;c.uniqueId=
function(a){var b=++O+"";return a?a+b:b};c.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},Q=/\\|'|\r|\n|\t|\u2028|\u2029/g;c.template=function(a,b,d){var e;d=c.defaults({},d,c.templateSettings);var g=new RegExp([(d.escape||L).source,(d.interpolate||L).source,(d.evaluate||L).source].join("|")+"|$","g"),m=0,n="__p+='";a.replace(g,function(b,c,d,e,g){n+=
a.slice(m,g).replace(Q,function(a){return"\\"+P[a]});c&&(n+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'");d&&(n+="'+\n((__t=("+d+"))==null?'':__t)+\n'");e&&(n+="';\n"+e+"\n__p+='");m=g+b.length;return b});n+="';\n";d.variable||(n="with(obj||{}){\n"+n+"}\n");n="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+n+"return __p;\n";try{e=new Function(d.variable||"obj","_",n)}catch(h){throw h.source=n,h;}if(b)return e(b,c);b=function(a){return e.call(this,a,
c)};b.source="function("+(d.variable||"obj")+"){\n"+n+"}";return b};c.chain=function(a){return c(a).chain()};var K=function(a){return this._chain?c(a).chain():a};c.mixin(c);u("pop push reverse shift sort splice unshift".split(" "),function(b){var d=a[b];c.prototype[b]=function(){var a=this._wrapped;d.apply(a,arguments);"shift"!=b&&"splice"!=b||0!==a.length||delete a[0];return K.call(this,a)}});u(["concat","join","slice"],function(b){var d=a[b];c.prototype[b]=function(){return K.call(this,d.apply(this._wrapped,
arguments))}});c.extend(c.prototype,{chain:function(){this._chain=!0;return this},value:function(){return this._wrapped}})}).call(this)},function(r,v,l){var f,k;(function(){function q(a){var d=!1;return function(){if(d)throw Error("Callback was already called.");d=!0;a.apply(b,arguments)}}var a={},b,t;b=this;null!=b&&(t=b.async);a.noConflict=function(){b.async=t;return a};var g=function(a,b){if(a.forEach)return a.forEach(b);for(var d=0;d<a.length;d+=1)b(a[d],d,a)},d=function(a,b){if(a.map)return a.map(b);
var d=[];g(a,function(a,c,e){d.push(b(a,c,e))});return d},e=function(a,b,d){if(a.reduce)return a.reduce(b,d);g(a,function(a,c,e){d=b(d,a,c,e)});return d},h=function(a){if(Object.keys)return Object.keys(a);var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(d);return b};"undefined"!==typeof process&&process.nextTick?(a.nextTick=process.nextTick,a.setImmediate="undefined"!==typeof setImmediate?function(a){setImmediate(a)}:a.nextTick):(a.nextTick="function"===typeof setImmediate?function(a){setImmediate(a)}:
function(a){setTimeout(a,0)},a.setImmediate=a.nextTick);a.each=function(a,b,d){d=d||function(){};if(!a.length)return d();var e=0;g(a,function(c){b(c,q(function(b){b?(d(b),d=function(){}):(e+=1,e>=a.length&&d(null))}))})};a.forEach=a.each;a.eachSeries=function(a,b,d){d=d||function(){};if(!a.length)return d();var e=0,c=function(){b(a[e],function(b){b?(d(b),d=function(){}):(e+=1,e>=a.length?d(null):c())})};c()};a.forEachSeries=a.eachSeries;a.eachLimit=function(a,b,d,e){A(b).apply(null,[a,d,e])};a.forEachLimit=
a.eachLimit;var A=function(a){return function(b,d,e){e=e||function(){};if(!b.length||0>=a)return e();var c=0,g=0,h=0;(function H(){if(c>=b.length)return e();for(;h<a&&g<b.length;)g+=1,h+=1,d(b[g-1],function(a){a?(e(a),e=function(){}):(c+=1,--h,c>=b.length?e():H())})})()}},y=function(b){return function(){var d=Array.prototype.slice.call(arguments);return b.apply(null,[a.each].concat(d))}},l=function(a,b){return function(){var d=Array.prototype.slice.call(arguments);return b.apply(null,[A(a)].concat(d))}},
p=function(b){return function(){var d=Array.prototype.slice.call(arguments);return b.apply(null,[a.eachSeries].concat(d))}},C=function(a,b,e,g){var c=[];b=d(b,function(a,b){return{index:b,value:a}});a(b,function(a,b){e(a.value,function(d,e){c[a.index]=e;b(d)})},function(a){g(a,c)})};a.map=y(C);a.mapSeries=p(C);a.mapLimit=function(a,b,d,e){return l(b,C)(a,d,e)};a.reduce=function(b,d,e,g){a.eachSeries(b,function(a,b){e(d,a,function(a,c){d=c;b(a)})},function(a){g(a,d)})};a.inject=a.reduce;a.foldl=a.reduce;
a.reduceRight=function(b,e,g,h){b=d(b,function(a){return a}).reverse();a.reduce(b,e,g,h)};a.foldr=a.reduceRight;var w=function(a,b,e,g){var c=[];b=d(b,function(a,b){return{index:b,value:a}});a(b,function(a,b){e(a.value,function(d){d&&c.push(a);b()})},function(a){g(d(c.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};a.filter=y(w);a.filterSeries=p(w);a.select=a.filter;a.selectSeries=a.filterSeries;w=function(a,b,e,g){var c=[];b=d(b,function(a,b){return{index:b,value:a}});
a(b,function(a,b){e(a.value,function(d){d||c.push(a);b()})},function(a){g(d(c.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};a.reject=y(w);a.rejectSeries=p(w);w=function(a,b,d,e){a(b,function(a,b){d(a,function(d){d?(e(a),e=function(){}):b()})},function(a){e()})};a.detect=y(w);a.detectSeries=p(w);a.some=function(b,d,e){a.each(b,function(a,b){d(a,function(a){a&&(e(!0),e=function(){});b()})},function(a){e(!1)})};a.any=a.some;a.every=function(b,d,e){a.each(b,function(a,b){d(a,
function(a){a||(e(!1),e=function(){});b()})},function(a){e(!0)})};a.all=a.every;a.sortBy=function(b,e,g){a.map(b,function(a,b){e(a,function(d,e){d?b(d):b(null,{value:a,criteria:e})})},function(a,b){if(a)return g(a);g(null,d(b.sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),function(a){return a.value}))})};a.auto=function(b,d){d=d||function(){};var f=h(b);if(!f.length)return d(null);var t={},c=[],k=function(){g(c.slice(0),function(a){a()})};c.unshift(function(){h(t).length===
f.length&&(d(null,t),d=function(){})});g(f,function(f){var A=b[f]instanceof Function?[b[f]]:b[f],x=function(b){var c=Array.prototype.slice.call(arguments,1);1>=c.length&&(c=c[0]);if(b){var e={};g(h(t),function(a){e[a]=t[a]});e[f]=c;d(b,e);d=function(){}}else t[f]=c,a.setImmediate(k)},q=A.slice(0,Math.abs(A.length-1))||[],p=function(){return e(q,function(a,b){return a&&t.hasOwnProperty(b)},!0)&&!t.hasOwnProperty(f)};if(p())A[A.length-1](x,t);else{var y=function(){if(p()){a:for(var a=y,b=0;b<c.length;b+=
1)if(c[b]===a){c.splice(b,1);break a}A[A.length-1](x,t)}};c.unshift(y)}})};a.waterfall=function(b,d){d=d||function(){};if(b.constructor!==Array)return d(Error("First argument to waterfall must be an array of functions"));if(!b.length)return d();var e=function(b){return function(c){if(c)d.apply(null,arguments),d=function(){};else{var g=Array.prototype.slice.call(arguments,1),h=b.next();h?g.push(e(h)):g.push(d);a.setImmediate(function(){b.apply(null,g)})}}};e(a.iterator(b))()};var z=function(a,b,d){d=
d||function(){};if(b.constructor===Array)a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);1>=c.length&&(c=c[0]);b.call(null,a,c)})},d);else{var e={};a.each(h(b),function(a,d){b[a](function(b){var g=Array.prototype.slice.call(arguments,1);1>=g.length&&(g=g[0]);e[a]=g;d(b)})},function(a){d(a,e)})}};a.parallel=function(b,d){z({map:a.map,each:a.each},b,d)};a.parallelLimit=function(a,b,d){z({map:l(b,C),each:A(b)},a,d)};a.series=function(b,d){d=d||function(){};if(b.constructor===
Array)a.mapSeries(b,function(a,b){a&&a(function(a){var d=Array.prototype.slice.call(arguments,1);1>=d.length&&(d=d[0]);b.call(null,a,d)})},d);else{var e={};a.eachSeries(h(b),function(a,c){b[a](function(b){var d=Array.prototype.slice.call(arguments,1);1>=d.length&&(d=d[0]);e[a]=d;c(b)})},function(a){d(a,e)})}};a.iterator=function(a){var b=function(d){var e=function(){a.length&&a[d].apply(null,arguments);return e.next()};e.next=function(){return d<a.length-1?b(d+1):null};return e};return b(0)};a.apply=
function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};w=function(a,b,d,e){var c=[];a(b,function(a,b){d(a,function(a,d){c=c.concat(d||[]);b(a)})},function(a){e(a,c)})};a.concat=y(w);a.concatSeries=p(w);a.whilst=function(b,d,e){b()?d(function(g){if(g)return e(g);a.whilst(b,d,e)}):e()};a.doWhilst=function(b,d,e){b(function(g){if(g)return e(g);d()?a.doWhilst(b,d,e):e()})};a.until=function(b,d,e){b()?e():d(function(g){if(g)return e(g);
a.until(b,d,e)})};a.doUntil=function(b,d,e){b(function(g){if(g)return e(g);d()?e():a.doUntil(b,d,e)})};a.queue=function(b,d){function e(b,c,h,f){c.constructor!==Array&&(c=[c]);g(c,function(c){c={data:c,callback:"function"===typeof f?f:null};h?b.tasks.unshift(c):b.tasks.push(c);b.saturated&&b.tasks.length===d&&b.saturated();a.setImmediate(b.process)})}void 0===d&&(d=1);var h=0,c={tasks:[],concurrency:d,saturated:null,empty:null,drain:null,push:function(a,b){e(c,a,!1,b)},unshift:function(a,b){e(c,a,
!0,b)},process:function(){if(h<c.concurrency&&c.tasks.length){var a=c.tasks.shift();c.empty&&0===c.tasks.length&&c.empty();h+=1;var d=q(function(){--h;a.callback&&a.callback.apply(a,arguments);c.drain&&0===c.tasks.length+h&&c.drain();c.process()});b(a.data,d)}},length:function(){return c.tasks.length},running:function(){return h}};return c};a.cargo=function(b,e){var h=!1,f=[],c={tasks:f,payload:e,saturated:null,empty:null,drain:null,push:function(b,d){b.constructor!==Array&&(b=[b]);g(b,function(a){f.push({data:a,
callback:"function"===typeof d?d:null});c.saturated&&f.length===e&&c.saturated()});a.setImmediate(c.process)},process:function G(){if(!h)if(0===f.length)c.drain&&c.drain();else{var a="number"===typeof e?f.splice(0,e):f.splice(0),t=d(a,function(a){return a.data});c.empty&&c.empty();h=!0;b(t,function(){h=!1;var b=arguments;g(a,function(a){a.callback&&a.callback.apply(null,b)});G()})}},length:function(){return f.length},running:function(){return h}};return c};w=function(a){return function(b){var d=Array.prototype.slice.call(arguments,
1);b.apply(null,d.concat([function(b){var d=Array.prototype.slice.call(arguments,1);"undefined"!==typeof console&&(b?console.error&&console.error(b):console[a]&&g(d,function(b){console[a](b)}))}]))}};a.log=w("log");a.dir=w("dir");a.memoize=function(a,b){var d={},e={};b=b||function(a){return a};var c=function(){var c=Array.prototype.slice.call(arguments),g=c.pop(),h=b.apply(null,c);h in d?g.apply(null,d[h]):h in e?e[h].push(g):(e[h]=[g],a.apply(null,c.concat([function(){d[h]=arguments;var a=e[h];delete e[h];
for(var b=0,c=a.length;b<c;b++)a[b].apply(null,arguments)}])))};c.memo=d;c.unmemoized=a;return c};a.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}};a.times=function(b,d,e){for(var g=[],c=0;c<b;c++)g.push(c);return a.map(g,d,e)};a.timesSeries=function(b,d,e){for(var g=[],c=0;c<b;c++)g.push(c);return a.mapSeries(g,d,e)};a.compose=function(){var b=Array.prototype.reverse.call(arguments);return function(){var d=this,e=Array.prototype.slice.call(arguments),g=e.pop();
a.reduce(b,e,function(a,b,e){b.apply(d,a.concat([function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);e(a,b)}]))},function(a,b){g.apply(d,[a].concat(b))})}};w=function(a,b){var d=function(){var d=this,e=Array.prototype.slice.call(arguments),g=e.pop();return a(b,function(a,b){a.apply(d,e.concat([b]))},g)};if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return d.apply(this,e)}return d};a.applyEach=y(w);a.applyEachSeries=p(w);a.forever=function(a,b){function d(e){if(e){if(b)return b(e);
throw e;}a(d)}d()};!(f=[],k=function(){return a}.apply(v,f),void 0!==k&&(r.exports=k))})()},function(r,v,l){function f(){this.buffer=[];this.ready=!1;this.queue=k.queue(function(f,a){for(var b=[],t=0;t<f.arguments.length;t+=1)b.push(f.arguments[t]);var g=f.arguments[f.arguments.length-1];"function"===typeof g?b[b.length-1]=function(){"function"===typeof setImmediate?setImmediate(a):process.nextTick(a);g.apply(null,arguments)}:g||0===f.arguments.length?b.push(function(){a()}):b[b.length-1]=function(){a()};
f.fn.apply(f["this"],b)},1)}var k=l(6);f.prototype.push=function(f,a){this.ready||a?this.queue.push(f):this.buffer.push(f)};f.prototype.processBuffer=function(){var f;this.ready=!0;for(f=0;f<this.buffer.length;f+=1)this.queue.push(this.buffer[f]);this.buffer=[]};r.exports=f},function(r,v,l){function f(a,b){return a===b}function k(a){return null===a?"$null":"string"===typeof a?"$string"+a:"boolean"===typeof a?"$boolean"+a:"number"===typeof a?"$number"+a:g.isArray(a)?"$date"+a.getTime():a}function q(a){this.fieldName=
a.fieldName;this.unique=a.unique||!1;this.sparse=a.sparse||!1;this.treeOptions={unique:this.unique,compareKeys:b.compareThings,checkValueEquality:f};this.reset()}var a=l(9).AVLTree,b=l(3),t=l(5),g=l(4);q.prototype.reset=function(b){this.tree=new a(this.treeOptions);b&&this.insert(b)};q.prototype.insert=function(a){var e,h,f,y;if(g.isArray(a))this.insertMultipleDocs(a);else if(e=b.getDotValue(a,this.fieldName),void 0!==e||!this.sparse)if(g.isArray(e)){e=t.uniq(e,k);for(h=0;h<e.length;h+=1)try{this.tree.insert(e[h],
a)}catch(l){y=l;f=h;break}if(y){for(h=0;h<f;h+=1)this.tree["delete"](e[h],a);throw y;}}else this.tree.insert(e,a)};q.prototype.insertMultipleDocs=function(a){var b,g,f;for(b=0;b<a.length;b+=1)try{this.insert(a[b])}catch(t){g=t;f=b;break}if(g){for(b=0;b<f;b+=1)this.remove(a[b]);throw g;}};q.prototype.remove=function(a){var e,f=this;g.isArray(a)?a.forEach(function(a){f.remove(a)}):(e=b.getDotValue(a,this.fieldName),void 0===e&&this.sparse||(g.isArray(e)?t.uniq(e,k).forEach(function(b){f.tree["delete"](b,
a)}):this.tree["delete"](e,a)))};q.prototype.update=function(a,b){if(g.isArray(a))this.updateMultipleDocs(a);else{this.remove(a);try{this.insert(b)}catch(f){throw this.insert(a),f;}}};q.prototype.updateMultipleDocs=function(a){var b,g,f;for(b=0;b<a.length;b+=1)this.remove(a[b].oldDoc);for(b=0;b<a.length;b+=1)try{this.insert(a[b].newDoc)}catch(t){f=t;g=b;break}if(f){for(b=0;b<g;b+=1)this.remove(a[b].newDoc);for(b=0;b<a.length;b+=1)this.insert(a[b].oldDoc);throw f;}};q.prototype.revertUpdate=function(a,
b){var f=[];g.isArray(a)?(a.forEach(function(a){f.push({oldDoc:a.newDoc,newDoc:a.oldDoc})}),this.update(f)):this.update(b,a)};q.prototype.getMatching=function(a){var b=this;if(g.isArray(a)){var f={},t=[];a.forEach(function(a){b.getMatching(a).forEach(function(a){f[a._id]=a})});Object.keys(f).forEach(function(a){t.push(f[a])});return t}return b.tree.search(a)};q.prototype.getBetweenBounds=function(a){return this.tree.betweenBounds(a)};q.prototype.getAll=function(){var a=[];this.tree.executeOnEveryNode(function(b){var g;
for(g=0;g<b.data.length;g+=1)a.push(b.data[g])});return a};r.exports=q},function(r,v,l){r.exports.BinarySearchTree=l(10);r.exports.AVLTree=l(12)},function(r,v,l){function f(a){a=a||{};this.right=this.left=null;this.parent=void 0!==a.parent?a.parent:null;a.hasOwnProperty("key")&&(this.key=a.key);this.data=a.hasOwnProperty("value")?[a.value]:[];this.unique=a.unique||!1;this.compareKeys=a.compareKeys||q.defaultCompareKeysFunction;this.checkValueEquality=a.checkValueEquality||q.defaultCheckValueEquality}
function k(a,b){var f;for(f=0;f<b.length;f+=1)a.push(b[f])}var q=l(11);f.prototype.getMaxKeyDescendant=function(){return this.right?this.right.getMaxKeyDescendant():this};f.prototype.getMaxKey=function(){return this.getMaxKeyDescendant().key};f.prototype.getMinKeyDescendant=function(){return this.left?this.left.getMinKeyDescendant():this};f.prototype.getMinKey=function(){return this.getMinKeyDescendant().key};f.prototype.checkAllNodesFullfillCondition=function(a){this.hasOwnProperty("key")&&(a(this.key,
this.data),this.left&&this.left.checkAllNodesFullfillCondition(a),this.right&&this.right.checkAllNodesFullfillCondition(a))};f.prototype.checkNodeOrdering=function(){var a=this;this.hasOwnProperty("key")&&(this.left&&(this.left.checkAllNodesFullfillCondition(function(b){if(0<=a.compareKeys(b,a.key))throw Error("Tree with root "+a.key+" is not a binary search tree");}),this.left.checkNodeOrdering()),this.right&&(this.right.checkAllNodesFullfillCondition(function(b){if(0>=a.compareKeys(b,a.key))throw Error("Tree with root "+
a.key+" is not a binary search tree");}),this.right.checkNodeOrdering()))};f.prototype.checkInternalPointers=function(){if(this.left){if(this.left.parent!==this)throw Error("Parent pointer broken for key "+this.key);this.left.checkInternalPointers()}if(this.right){if(this.right.parent!==this)throw Error("Parent pointer broken for key "+this.key);this.right.checkInternalPointers()}};f.prototype.checkIsBST=function(){this.checkNodeOrdering();this.checkInternalPointers();if(this.parent)throw Error("The root shouldn't have a parent");
};f.prototype.getNumberOfKeys=function(){var a;if(!this.hasOwnProperty("key"))return 0;a=1;this.left&&(a+=this.left.getNumberOfKeys());this.right&&(a+=this.right.getNumberOfKeys());return a};f.prototype.createSimilar=function(a){a=a||{};a.unique=this.unique;a.compareKeys=this.compareKeys;a.checkValueEquality=this.checkValueEquality;return new this.constructor(a)};f.prototype.createLeftChild=function(a){a=this.createSimilar(a);a.parent=this;return this.left=a};f.prototype.createRightChild=function(a){a=
this.createSimilar(a);a.parent=this;return this.right=a};f.prototype.insert=function(a,b){if(this.hasOwnProperty("key"))if(0===this.compareKeys(this.key,a)){if(this.unique){var f=Error("Can't insert key "+a+", it violates the unique constraint");f.key=a;f.errorType="uniqueViolated";throw f;}this.data.push(b)}else 0>this.compareKeys(a,this.key)?this.left?this.left.insert(a,b):this.createLeftChild({key:a,value:b}):this.right?this.right.insert(a,b):this.createRightChild({key:a,value:b});else this.key=
a,this.data.push(b)};f.prototype.search=function(a){return this.hasOwnProperty("key")?0===this.compareKeys(this.key,a)?this.data:0>this.compareKeys(a,this.key)?this.left?this.left.search(a):[]:this.right?this.right.search(a):[]:[]};f.prototype.getLowerBoundMatcher=function(a){var b=this;return a.hasOwnProperty("$gt")||a.hasOwnProperty("$gte")?a.hasOwnProperty("$gt")&&a.hasOwnProperty("$gte")?0===b.compareKeys(a.$gte,a.$gt)?function(f){return 0<b.compareKeys(f,a.$gt)}:0<b.compareKeys(a.$gte,a.$gt)?
function(f){return 0<=b.compareKeys(f,a.$gte)}:function(f){return 0<b.compareKeys(f,a.$gt)}:a.hasOwnProperty("$gt")?function(f){return 0<b.compareKeys(f,a.$gt)}:function(f){return 0<=b.compareKeys(f,a.$gte)}:function(){return!0}};f.prototype.getUpperBoundMatcher=function(a){var b=this;return a.hasOwnProperty("$lt")||a.hasOwnProperty("$lte")?a.hasOwnProperty("$lt")&&a.hasOwnProperty("$lte")?0===b.compareKeys(a.$lte,a.$lt)?function(f){return 0>b.compareKeys(f,a.$lt)}:0>b.compareKeys(a.$lte,a.$lt)?function(f){return 0>=
b.compareKeys(f,a.$lte)}:function(f){return 0>b.compareKeys(f,a.$lt)}:a.hasOwnProperty("$lt")?function(f){return 0>b.compareKeys(f,a.$lt)}:function(f){return 0>=b.compareKeys(f,a.$lte)}:function(){return!0}};f.prototype.betweenBounds=function(a,b,f){var g=[];if(!this.hasOwnProperty("key"))return[];b=b||this.getLowerBoundMatcher(a);f=f||this.getUpperBoundMatcher(a);b(this.key)&&this.left&&k(g,this.left.betweenBounds(a,b,f));b(this.key)&&f(this.key)&&k(g,this.data);f(this.key)&&this.right&&k(g,this.right.betweenBounds(a,
b,f));return g};f.prototype.deleteIfLeaf=function(){if(this.left||this.right)return!1;if(!this.parent)return delete this.key,this.data=[],!0;this.parent.left===this?this.parent.left=null:this.parent.right=null;return!0};f.prototype.deleteIfOnlyOneChild=function(){var a;this.left&&!this.right&&(a=this.left);!this.left&&this.right&&(a=this.right);if(!a)return!1;if(!this.parent)return this.key=a.key,this.data=a.data,this.left=null,a.left&&(this.left=a.left,a.left.parent=this),this.right=null,a.right&&
(this.right=a.right,a.right.parent=this),!0;this.parent.left===this?this.parent.left=a:this.parent.right=a;a.parent=this.parent;return!0};f.prototype["delete"]=function(a,b){var f=[],g,d=this;this.hasOwnProperty("key")&&(0>this.compareKeys(a,this.key)?this.left&&this.left["delete"](a,b):0<this.compareKeys(a,this.key)?this.right&&this.right["delete"](a,b):0!==!this.compareKeys(a,this.key)&&(1<this.data.length&&void 0!==b?(this.data.forEach(function(a){d.checkValueEquality(a,b)||f.push(a)}),d.data=
f):this.deleteIfLeaf()||this.deleteIfOnlyOneChild()||(.5<=Math.random()?(g=this.left.getMaxKeyDescendant(),this.key=g.key,this.data=g.data,this===g.parent?this.left=g.left:g.parent.right=g.left,g.left&&(g.left.parent=g.parent)):(g=this.right.getMinKeyDescendant(),this.key=g.key,this.data=g.data,this===g.parent?this.right=g.right:g.parent.left=g.right,g.right&&(g.right.parent=g.parent)))))};f.prototype.executeOnEveryNode=function(a){this.left&&this.left.executeOnEveryNode(a);a(this);this.right&&this.right.executeOnEveryNode(a)};
f.prototype.prettyPrint=function(a,b){b=b||"";console.log(b+"* "+this.key);a&&console.log(b+"* "+this.data);if(this.left||this.right)this.left?this.left.prettyPrint(a,b+"  "):console.log(b+"  *"),this.right?this.right.prettyPrint(a,b+"  "):console.log(b+"  *")};r.exports=f},function(r,v){function l(f){var k;if(0===f)return[];if(1===f)return[0];k=l(f-1);k.splice(Math.floor(Math.random()*f),0,f-1);return k}r.exports.getRandomArray=l;r.exports.defaultCompareKeysFunction=function(f,k){if(f<k)return-1;
if(f>k)return 1;if(f===k)return 0;var l=Error("Couldn't compare elements");l.a=f;l.b=k;throw l;};r.exports.defaultCheckValueEquality=function(f,k){return f===k}},function(r,v,l){function f(a){this.tree=new k(a)}function k(a){a=a||{};this.right=this.left=null;this.parent=void 0!==a.parent?a.parent:null;a.hasOwnProperty("key")&&(this.key=a.key);this.data=a.hasOwnProperty("value")?[a.value]:[];this.unique=a.unique||!1;this.compareKeys=a.compareKeys||q.defaultCompareKeysFunction;this.checkValueEquality=
a.checkValueEquality||q.defaultCheckValueEquality}v=l(10);var q=l(11),a=l(4);l(5);a.inherits(k,v);f._AVLTree=k;k.prototype.checkHeightCorrect=function(){var a,f;if(this.hasOwnProperty("key")){if(this.left&&void 0===this.left.height)throw Error("Undefined height for node "+this.left.key);if(this.right&&void 0===this.right.height)throw Error("Undefined height for node "+this.right.key);if(void 0===this.height)throw Error("Undefined height for node "+this.key);a=this.left?this.left.height:0;f=this.right?
this.right.height:0;if(this.height!==1+Math.max(a,f))throw Error("Height constraint failed for node "+this.key);this.left&&this.left.checkHeightCorrect();this.right&&this.right.checkHeightCorrect()}};k.prototype.balanceFactor=function(){return(this.left?this.left.height:0)-(this.right?this.right.height:0)};k.prototype.checkBalanceFactors=function(){if(1<Math.abs(this.balanceFactor()))throw Error("Tree is unbalanced at node "+this.key);this.left&&this.left.checkBalanceFactors();this.right&&this.right.checkBalanceFactors()};
k.prototype.checkIsAVLT=function(){k.super_.prototype.checkIsBST.call(this);this.checkHeightCorrect();this.checkBalanceFactors()};f.prototype.checkIsAVLT=function(){this.tree.checkIsAVLT()};k.prototype.rightRotation=function(){var a=this.left,f,g;if(!a)return this;f=a.right;this.parent?(a.parent=this.parent,this.parent.left===this?this.parent.left=a:this.parent.right=a):a.parent=null;a.right=this;this.parent=a;if(this.left=f)f.parent=this;g=a.left?a.left.height:0;this.height=Math.max(f?f.height:0,
this.right?this.right.height:0)+1;a.height=Math.max(g,this.height)+1;return a};k.prototype.leftRotation=function(){var a=this.right,f,g,d;if(!a)return this;f=a.left;this.parent?(a.parent=this.parent,this.parent.left===this?this.parent.left=a:this.parent.right=a):a.parent=null;a.left=this;this.parent=a;if(this.right=f)f.parent=this;g=this.left?this.left.height:0;f=f?f.height:0;d=a.right?a.right.height:0;this.height=Math.max(g,f)+1;a.height=Math.max(d,this.height)+1;return a};k.prototype.rightTooSmall=
function(){if(1>=this.balanceFactor())return this;0>this.left.balanceFactor()&&this.left.leftRotation();return this.rightRotation()};k.prototype.leftTooSmall=function(){if(-1<=this.balanceFactor())return this;0<this.right.balanceFactor()&&this.right.rightRotation();return this.leftRotation()};k.prototype.rebalanceAlongPath=function(a){var f=this,g,d;if(!this.hasOwnProperty("key"))return delete this.height,this;for(d=a.length-1;0<=d;--d)a[d].height=1+Math.max(a[d].left?a[d].left.height:0,a[d].right?
a[d].right.height:0),1<a[d].balanceFactor()&&(g=a[d].rightTooSmall(),0===d&&(f=g)),-1>a[d].balanceFactor()&&(g=a[d].leftTooSmall(),0===d&&(f=g));return f};k.prototype.insert=function(a,f){var g=[],d=this;if(!this.hasOwnProperty("key"))return this.key=a,this.data.push(f),this.height=1,this;for(;;){if(0===d.compareKeys(d.key,a)){if(d.unique)throw g=Error("Can't insert key "+a+", it violates the unique constraint"),g.key=a,g.errorType="uniqueViolated",g;d.data.push(f);return this}g.push(d);if(0>d.compareKeys(a,
d.key))if(d.left)d=d.left;else{g.push(d.createLeftChild({key:a,value:f}));break}else if(d.right)d=d.right;else{g.push(d.createRightChild({key:a,value:f}));break}}return this.rebalanceAlongPath(g)};f.prototype.insert=function(a,f){var g=this.tree.insert(a,f);g&&(this.tree=g)};k.prototype["delete"]=function(a,f){var g=[],d,e=this,h=[];if(!this.hasOwnProperty("key"))return this;for(;0!==e.compareKeys(a,e.key);)if(h.push(e),0>e.compareKeys(a,e.key))if(e.left)e=e.left;else return this;else if(e.right)e=
e.right;else return this;if(1<e.data.length&&f)return e.data.forEach(function(a){e.checkValueEquality(a,f)||g.push(a)}),e.data=g,this;if(!e.left&&!e.right){if(e===this)return delete e.key,e.data=[],delete e.height,this;e.parent.left===e?e.parent.left=null:e.parent.right=null;return this.rebalanceAlongPath(h)}if(!e.left||!e.right){d=e.left?e.left:e.right;if(e===this)return d.parent=null,d;e.parent.left===e?e.parent.left=d:e.parent.right=d;d.parent=e.parent;return this.rebalanceAlongPath(h)}h.push(e);
d=e.left;if(!d.right){e.key=d.key;e.data=d.data;if(e.left=d.left)d.left.parent=e;return this.rebalanceAlongPath(h)}for(;;)if(d.right)h.push(d),d=d.right;else break;e.key=d.key;e.data=d.data;if(d.parent.right=d.left)d.left.parent=d.parent;return this.rebalanceAlongPath(h)};f.prototype["delete"]=function(a,f){var g=this.tree["delete"](a,f);g&&(this.tree=g)};["getNumberOfKeys","search","betweenBounds","prettyPrint","executeOnEveryNode"].forEach(function(a){f.prototype[a]=function(){return this.tree[a].apply(this.tree,
arguments)}});r.exports=f},function(r,v,l){function f(a){var b,g,k;this.db=a.db;this.inMemoryOnly=this.db.inMemoryOnly;this.filename=this.db.filename;this.corruptAlertThreshold=void 0!==a.corruptAlertThreshold?a.corruptAlertThreshold:.1;if(!this.inMemoryOnly&&this.filename&&"~"===this.filename.charAt(this.filename.length-1))throw Error("The datafile name can't end with a ~, which is reserved for crash safe backup files");if(a.afterSerialization&&!a.beforeDeserialization)throw Error("Serialization hook defined but deserialization hook undefined, cautiously refusing to start NeDB to prevent dataloss");
if(!a.afterSerialization&&a.beforeDeserialization)throw Error("Serialization hook undefined but deserialization hook defined, cautiously refusing to start NeDB to prevent dataloss");this.afterSerialization=a.afterSerialization||function(a){return a};this.beforeDeserialization=a.beforeDeserialization||function(a){return a};for(b=1;30>b;b+=1)for(g=0;10>g;g+=1)if(k=t.uid(b),this.beforeDeserialization(this.afterSerialization(k))!==k)throw Error("beforeDeserialization is not the reverse of afterSerialization, cautiously refusing to start NeDB to prevent dataloss");
this.filename&&a.nodeWebkitAppName&&(console.log("=================================================================="),console.log("WARNING: The nodeWebkitAppName option is deprecated"),console.log("To get the path to the directory where Node Webkit stores the data"),console.log("for your app, use the internal nw.gui module like this"),console.log("require('nw.gui').App.dataPath"),console.log("See https://github.com/rogerwang/node-webkit/issues/500"),console.log("=================================================================="),
this.filename=f.getNWAppFilename(a.nodeWebkitAppName,this.filename))}var k=l(14),q=l(17),a=l(3),b=l(6),t=l(1),g=l(8);f.ensureDirectoryExists=function(a,b){var g=b||function(){};k.mkdirp(a,function(a){return g(a)})};f.getNWAppFilename=function(a,b){var g;switch(process.platform){case "win32":case "win64":g=process.env.LOCALAPPDATA||process.env.APPDATA;if(!g)throw Error("Couldn't find the base application data folder");g=q.join(g,a);break;case "darwin":g=process.env.HOME;if(!g)throw Error("Couldn't find the base application data directory");
g=q.join(g,"Library","Application Support",a);break;case "linux":g=process.env.HOME;if(!g)throw Error("Couldn't find the base application data directory");g=q.join(g,".config",a);break;default:throw Error("Can't use the Node Webkit relative path for platform "+process.platform);}return q.join(g,"nedb-data",b)};f.prototype.persistCachedDatabase=function(b){var e=b||function(){},g="",f=this;if(this.inMemoryOnly)return e(null);this.db.getAllData().forEach(function(b){g+=f.afterSerialization(a.serialize(b))+
"\n"});Object.keys(this.db.indexes).forEach(function(b){"_id"!=b&&(g+=f.afterSerialization(a.serialize({$$indexCreated:{fieldName:b,unique:f.db.indexes[b].unique,sparse:f.db.indexes[b].sparse}}))+"\n")});k.crashSafeWriteFile(this.filename,g,function(a){if(a)return e(a);f.db.emit("compaction.done");return e(null)})};f.prototype.compactDatafile=function(){this.db.executor.push({"this":this,fn:this.persistCachedDatabase,arguments:[]})};f.prototype.setAutocompactionInterval=function(a){var b=this;a=Math.max(a||
0,5E3);this.stopAutocompaction();this.autocompactionIntervalId=setInterval(function(){b.compactDatafile()},a)};f.prototype.stopAutocompaction=function(){this.autocompactionIntervalId&&clearInterval(this.autocompactionIntervalId)};f.prototype.persistNewState=function(b,e){var g=this,f="",t=e||function(){};if(g.inMemoryOnly)return t(null);b.forEach(function(b){f+=g.afterSerialization(a.serialize(b))+"\n"});if(0===f.length)return t(null);k.appendFile(g.filename,f,"utf8",function(a){return t(a)})};f.prototype.treatRawData=
function(b){b=b.split("\n");var e={},g=[],f,k={},t=-1;for(f=0;f<b.length;f+=1){var p;try{p=a.deserialize(this.beforeDeserialization(b[f])),p._id?!0===p.$$deleted?delete e[p._id]:e[p._id]=p:p.$$indexCreated&&void 0!=p.$$indexCreated.fieldName?k[p.$$indexCreated.fieldName]=p.$$indexCreated:"string"===typeof p.$$indexRemoved&&delete k[p.$$indexRemoved]}catch(l){t+=1}}if(0<b.length&&t/b.length>this.corruptAlertThreshold)throw Error("More than "+Math.floor(100*this.corruptAlertThreshold)+"% of the data file is corrupt, the wrong beforeDeserialization hook may be used. Cautiously refusing to start NeDB to prevent dataloss");
Object.keys(e).forEach(function(a){g.push(e[a])});return{data:g,indexes:k}};f.prototype.loadDatabase=function(a){var e=a||function(){},h=this;h.db.resetIndexes();if(h.inMemoryOnly)return e(null);b.waterfall([function(a){f.ensureDirectoryExists(q.dirname(h.filename),function(b){k.ensureDatafileIntegrity(h.filename,function(b){k.readFile(h.filename,"utf8",function(b,d){if(b)return a(b);try{var e=h.treatRawData(d)}catch(f){return a(f)}Object.keys(e.indexes).forEach(function(a){h.db.indexes[a]=new g(e.indexes[a])});
try{h.db.resetIndexes(e.data)}catch(f){return h.db.resetIndexes(),a(f)}h.db.persistence.persistCachedDatabase(a)})})})}],function(a){if(a)return e(a);h.db.executor.processBuffer();return e(null)})};r.exports=f},function(r,v,l){var f=l(15);v=l(16);var k=l(6),q=l(17),a={};a.exists=f.exists;a.rename=f.rename;a.writeFile=f.writeFile;a.unlink=f.unlink;a.appendFile=f.appendFile;a.readFile=f.readFile;a.mkdirp=v;a.ensureFileDoesntExist=function(b,f){a.exists(b,function(g){if(!g)return f(null);a.unlink(b,
function(a){return f(a)})})};a.flushToStorage=function(a,k){var g,d;"string"===typeof a?(g=a,d="r+"):(g=a.filename,d=a.isDir?"r":"r+");if("r"===d&&("win32"===process.platform||"win64"===process.platform))return k(null);f.open(g,d,function(a,b){if(a)return k(a);f.fsync(b,function(a){f.close(b,function(b){if(a||b){var d=Error("Failed to flush to storage");d.errorOnFsync=a;d.errorOnClose=b;return k(d)}return k(null)})})})};a.crashSafeWriteFile=function(b,f,g){var d=g||function(){},e=b+"~";k.waterfall([k.apply(a.flushToStorage,
{filename:q.dirname(b),isDir:!0}),function(d){a.exists(b,function(e){if(e)a.flushToStorage(b,function(a){return d(a)});else return d()})},function(b){a.writeFile(e,f,function(a){return b(a)})},k.apply(a.flushToStorage,e),function(d){a.rename(e,b,function(a){return d(a)})},k.apply(a.flushToStorage,{filename:q.dirname(b),isDir:!0})],function(a){return d(a)})};a.ensureDatafileIntegrity=function(b,f){var g=b+"~";a.exists(b,function(d){if(d)return f(null);a.exists(g,function(d){if(!d)return a.writeFile(b,
"","utf8",function(a){f(a)});a.rename(g,b,function(a){return f(a)})})})};r.exports=a},function(r,v){r.exports=require("fs")},function(r,v,l){function f(a,b,t,g){"function"===typeof b?(t=b,b={}):b&&"object"===typeof b||(b={mode:b});var d=b.mode,e=b.fs||q;void 0===d&&(d=511&~process.umask());g||(g=null);var h=t||function(){};a=k.resolve(a);e.mkdir(a,d,function(d){if(!d)return g=g||a,h(null,g);switch(d.code){case "ENOENT":f(k.dirname(a),b,function(d,e){d?h(d,e):f(a,b,h,e)});break;default:e.stat(a,function(a,
b){a||!b.isDirectory()?h(d,g):h(null,g)})}})}var k=l(17),q=l(15);r.exports=f.mkdirp=f.mkdirP=f;f.sync=function b(f,g,d){g&&"object"===typeof g||(g={mode:g});var e=g.mode,h=g.fs||q;void 0===e&&(e=511&~process.umask());d||(d=null);f=k.resolve(f);try{h.mkdirSync(f,e),d=d||f}catch(l){switch(l.code){case "ENOENT":d=b(k.dirname(f),g,d);b(f,g,d);break;default:var r;try{r=h.statSync(f)}catch(v){throw l;}if(!r.isDirectory())throw l;}}return d}},function(r,v){r.exports=require("path")},function(r,v,l){function f(a,
b,f){this.db=a;this.query=b||{};f&&(this.execFn=f)}var k=l(3),q=l(5);f.prototype.limit=function(a){this._limit=a;return this};f.prototype.skip=function(a){this._skip=a;return this};f.prototype.sort=function(a){this._sort=a;return this};f.prototype.projection=function(a){this._projection=a;return this};f.prototype.project=function(a){var b=[],f=this,g,d,e;if(void 0===this._projection||0===Object.keys(this._projection).length)return a;g=0===this._projection._id?!1:!0;this._projection=q.omit(this._projection,
"_id");e=Object.keys(this._projection);e.forEach(function(a){if(void 0!==d&&f._projection[a]!==d)throw Error("Can't both keep and omit fields except for _id");d=f._projection[a]});a.forEach(function(a){var f;1===d?(f={$set:{}},e.forEach(function(b){f.$set[b]=k.getDotValue(a,b);void 0===f.$set[b]&&delete f.$set[b]}),f=k.modify({},f)):(f={$unset:{}},e.forEach(function(a){f.$unset[a]=!0}),f=k.modify(a,f));g?f._id=a._id:delete f._id;b.push(f)});return b};f.prototype._exec=function(a){function b(b,d){return e.execFn?
e.execFn(b,d,a):a(b,d)}var f=[],g=0,d=0,e=this,h=null,l,q,r;this.db.getCandidates(this.query,function(a,v){if(a)return b(a);try{for(l=0;l<v.length;l+=1)if(k.match(v[l],e.query))if(e._sort)f.push(v[l]);else if(e._skip&&e._skip>d)d+=1;else if(f.push(v[l]),g+=1,e._limit&&e._limit<=g)break}catch(m){return b(m)}if(e._sort){q=Object.keys(e._sort);var w=[];for(l=0;l<q.length;l++)r=q[l],w.push({key:r,direction:e._sort[r]});f.sort(function(a,b){var d,f;for(f=0;f<w.length;f++)if(d=w[f],d=d.direction*k.compareThings(k.getDotValue(a,
d.key),k.getDotValue(b,d.key),e.db.compareStrings),0!==d)return d;return 0});var z=e._skip||0;f=f.slice(z,z+(e._limit||f.length))}try{f=e.project(f)}catch(m){h=m,f=void 0}return b(h,f)})};f.prototype.exec=function(){this.db.executor.push({"this":this,fn:this._exec,arguments:arguments})};r.exports=f},function(r,v){r.exports=require("events")}]);
